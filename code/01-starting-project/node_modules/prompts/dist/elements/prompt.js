'use strict';

const readline = require('readline');

<<<<<<< HEAD
const _require = require('../util'),
      action = _require.action;

const EventEmitter = require('events');

const _require2 = require('sisteransi'),
      beep = _require2.beep,
      cursor = _require2.cursor;

const color = require('kleur');
/**
 * Base prompt skeleton
 * @param {Stream} [opts.stdin] The Readable stream to listen to
 * @param {Stream} [opts.stdout] The Writable stream to write readline data to
 */


class Prompt extends EventEmitter {
  constructor(opts = {}) {
    super();
    this.firstRender = true;
    this.in = opts.stdin || process.stdin;
    this.out = opts.stdout || process.stdout;

    this.onRender = (opts.onRender || (() => void 0)).bind(this);

    const rl = readline.createInterface({
      input: this.in,
      escapeCodeTimeout: 50
    });
    readline.emitKeypressEvents(this.in, rl);
    if (this.in.isTTY) this.in.setRawMode(true);
    const isSelect = ['SelectPrompt', 'MultiselectPrompt'].indexOf(this.constructor.name) > -1;

    const keypress = (str, key) => {
      let a = action(key, isSelect);

=======
var _require = require('../util');

const action = _require.action;

const EventEmitter = require('events');

var _require2 = require('sisteransi');

const beep = _require2.beep,
      cursor = _require2.cursor;

/**
 * Base prompt skeleton
 */

class Prompt extends EventEmitter {
  constructor(opts = {}) {
    super();

    this.in = opts.in || process.stdin;
    this.out = opts.out || process.stdout;

    const rl = readline.createInterface(this.in);
    readline.emitKeypressEvents(this.in, rl);

    if (this.in.isTTY) this.in.setRawMode(true);

    const keypress = (str, key) => {
      let a = action(key);
>>>>>>> fb9087a8f6cdc7859ecd725957ccb7c04a787284
      if (a === false) {
        this._ && this._(str, key);
      } else if (typeof this[a] === 'function') {
        this[a](key);
      } else {
        this.bell();
      }
    };

<<<<<<< HEAD
    this.close = () => {
=======
    const close = () => {
>>>>>>> fb9087a8f6cdc7859ecd725957ccb7c04a787284
      this.out.write(cursor.show);
      this.in.removeListener('keypress', keypress);
      if (this.in.isTTY) this.in.setRawMode(false);
      rl.close();
<<<<<<< HEAD
      this.emit(this.aborted ? 'abort' : this.exited ? 'exit' : 'submit', this.value);
      this.closed = true;
    };
=======
      this.emit(this.aborted ? 'abort' : 'submit', this.value);
    };
    this.close = close;
>>>>>>> fb9087a8f6cdc7859ecd725957ccb7c04a787284

    this.in.on('keypress', keypress);
  }

  fire() {
    this.emit('state', {
      value: this.value,
<<<<<<< HEAD
      aborted: !!this.aborted,
      exited: !!this.exited
=======
      aborted: !!this.aborted
>>>>>>> fb9087a8f6cdc7859ecd725957ccb7c04a787284
    });
  }

  bell() {
    this.out.write(beep);
  }
<<<<<<< HEAD

  render() {
    this.onRender(color);
    if (this.firstRender) this.firstRender = false;
  }

=======
>>>>>>> fb9087a8f6cdc7859ecd725957ccb7c04a787284
}

module.exports = Prompt;